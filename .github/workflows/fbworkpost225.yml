name: fb post share

permissions:
  contents: write
  actions: write

on:
  schedule:
    # ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ Ø¥Ù„Ù‰ 12 Ùˆ 42 Ù„ØªØ¬Ù†Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø°Ø±ÙˆØ© ÙÙŠ Ø³ÙŠØ±ÙØ±Ø§Øª GitHub Ù„Ø¶Ù…Ø§Ù† ØªØ´ØºÙŠÙ„ Ø£Ø³Ø±Ø¹
    - cron: "12,42 * * * *"
  workflow_dispatch: # ÙŠØªÙŠØ­ Ù„Ùƒ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª

jobs:
  run-bot:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          # Ù„Ø¶Ù…Ø§Ù† ÙˆØ¬ÙˆØ¯ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§ÙÙŠØ© Ù„Ø¹Ù…Ù„ Push Ù„Ø§Ø­Ù‚Ø§Ù‹
          persist-credentials: true

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install System Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libmagickwand-dev
          sudo apt-get install -y fonts-kacst fonts-noto-core fonts-noto-ui-core

      - name: Install Python Libraries
        run: |
          python -m pip install --upgrade pip
          pip install feedparser requests wand arabic-reshaper python-bidi

      - name: Run Python Bot
        env:
          PAGE_ID: ${{ secrets.PAGE_ID }}
          PAGE_ACCESS_TOKEN: ${{ secrets.PAGE_ACCESS_TOKEN }}
        run: python main.py

      - name: Commit and Push bot state
        run: |
          # Ø¥Ø¹Ø¯Ø§Ø¯ Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ù€ GitHub Ù„Ø¶Ù…Ø§Ù† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù€ Push Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

          # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø§ØªØ¬Ø© Ø¹Ù† Ø§Ù„Ø¨ÙˆØª
          git add posted_articles.txt last_feed_index.txt publish_log.txt final.png || true

          # ÙØ­Øµ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª: Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø¬Ø¯ÙŠØ¯ Ù„Ù† ÙŠÙ‚ÙˆÙ… Ø¨Ø¹Ù…Ù„ Commit (Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡)
          if git diff --cached --quiet; then
            echo "No changes to commit. Skipping push."
          else
            # Ø¥Ø¶Ø§ÙØ© [skip ci] ØªÙ…Ù†Ø¹ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨ÙˆØª ÙÙŠ Ø­Ù„Ù‚Ø© ØªØ´ØºÙŠÙ„ Ù…ÙØ±ØºØ©
            git commit -m "ğŸ¤– Bot state update [skip ci]"
            git push
          fi
